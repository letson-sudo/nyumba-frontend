// utils/imageUtils.js
export const getImageUrl = (imagePath, laravelApiBase = 'http://localhost:8000') => {
  if (!imagePath) return null;

  // If already a full URL, return as is
  if (imagePath.startsWith('http://') || imagePath.startsWith('https://')) {
    return imagePath;
  }

  // Remove leading slash if present to avoid double slashes
  const cleanPath = imagePath.startsWith('/') ? imagePath.slice(1) : imagePath;

  // If the path already includes 'storage/' prefix, use it directly with base URL
  if (cleanPath.startsWith('storage/')) {
    return `${laravelApiBase}/${cleanPath}`;
  }

  // If the path already includes 'property-images/', prepend only 'storage/'
  if (cleanPath.includes('property-images/')) {
    return `${laravelApiBase}/storage/${cleanPath}`;
  }

  // Otherwise, construct full path with storage/property-images/
  return `${laravelApiBase}/storage/property-images/${cleanPath}`;
};

export const processImageArray = (images, laravelApiBase) => {
  if (!Array.isArray(images)) return [];
  return images.map(img => getImageUrl(img, laravelApiBase)).filter(Boolean);
};

export const cleanLocationForBackend = (locationString) => {
  if (!locationString || typeof locationString !== 'string') return '';

  // Remove extra whitespace
  const trimmed = locationString.trim();

  // If location contains comma, take only the first part (city)
  const cityOnly = trimmed.split(',')[0].trim();

  // Log the cleaning process
  if (trimmed !== cityOnly) {
    console.log('ðŸ§¹ Location cleaned for backend:', {
      original: trimmed,
      cleaned: cityOnly,
      removed: trimmed.replace(cityOnly, '').trim()
    });
  }

  return cityOnly;
};

export const createPlaceholderImage = () => {
  return `data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMzAwIDI1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZGVmcz4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0ic2t5R3JhZGllbnQiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMCUiIHkyPSIxMDAlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3R5bGU9InN0b3AtY29sb3I6Izg3Q0VFQjtzdG9wLW9wYWNpdHk6MSIgLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdHlsZT0ic3RvcC1jb2xvcjojRTBGNkZGO3N0b3Atb3BhY2l0eToxIiAvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0icm9vZkdyYWRpZW50IiB4MT0iMCUiIHkxPSIwJSIgeDI9IjAlIiB5Mj0iMTAwJSI+CiAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM4QjQ1MTM7c3RvcC1vcGFjaXR5OjEiIC8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3R5bGU9InN0b3AtY29sb3I6IzY1NDMyMTtzdG9wLW9wYWNpdHk6MSIgLz4KICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImhvdXNlR3JhZGllbnQiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMCUiIHkyPSIxMDAlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3R5bGU9InN0b3AtY29sb3I6I0Y1RjVEQztzdG9wLW9wYWNpdHk6MSIgLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdHlsZT0ic3RvcC1jb2xvcjojRTZFNkNEO3N0b3Atb3BhY2l0eToxIiAvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iZ3JvdW5kR3JhZGllbnQiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMCUiIHkyPSIxMDAlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3R5bGU9InN0b3AtY29sb3I6IzkwRUU5MDtzdG9wLW9wYWNpdHk6MSIgLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdHlsZT0ic3RvcC1jb2xvcjojN0NCMzQyO3N0b3Atb3BhY2l0eToxIiAvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICA8L2RlZnM+CiAgCiAgPCEtLSBTa3kgYmFja2dyb3VuZCAtLT4KICA8cmVjdCB3aWR0aD0iMzAwIiBoZWlnaHQ9IjE4MCIgZmlsbD0idXJsKCNza3lHcmFkaWVudCkiLz4KICA8IS0tIEdyb3VuZCAtLT4KICA8cmVjdCB4PSIwIiB5PSIxODAiIHdpZHRoPSIzMDAiIGhlaWdodD0iNzAiIGZpbGw9InVybCgjZ3JvdW5kR3JhZGllbnQpIi8+CiAgCiAgPCEtLSBTdW4gLS0+CiAgPGNpcmNsZSBjeD0iNTAiIGN5PSI0MCIgcj0iMTgiIGZpbGw9IiNGRkQ3MDAiIG9wYWNpdHk9IjAuOCIvPgogIDxnIHN0cm9rZT0iI0ZGRDcwMCIgc3Ryb2tlLXdpZHRoPSIyIiBvcGFjaXR5PSIwLjYiPgogICAgPGxpbmUgeDE9IjIwIiB5MT0iNDAiIHgyPSIyOCIgeTI9IjQwIi8+CiAgICA8bGluZSB4MT0iNzIiIHkxPSI0MCIgeDI9IjgwIiB5Mj0iNDAiLz4KICAgIDxsaW5lIHgxPSI1MCIgeTE9IjEwIiB4Mj0iNTAiIHkyPSIxOCIvPgogICAgPGxpbmUgeDE9IjUwIiB5MT0iNjIiIHgyPSI1MCIgeTI9IjcwIi8+CiAgICA8bGluZSB4MT0iMjguOCIgeTE9IjE4LjgiIHgyPSIzNC4xIiB5Mj0iMjQuMSIvPgogICAgPGxpbmUgeDE9IjY1LjkiIHkxPSI1NS45IiB4Mj0iNzEuMiIgeTI9IjYxLjIiLz4KICAgIDxsaW5lIHgxPSI3MS4yIiB5MT0iMTguOCIgeDI9IjY1LjkiIHkyPSIyNC4xIi8+CiAgICA8bGluZSB4MT0iMzQuMSIgeTE9IjU1LjkiIHgyPSIyOC44IiB5Mj0iNjEuMiIvPgogIDwvZz4KICA8IS0tIENsb3VkcyAtLT4KICA8ZyBmaWxsPSJ3aGl0ZSIgb3BhY2l0eT0iMC43Ij4KICAgIDxlbGxpcHNlIGN4PSIxODAiIGN5PSIzNSIgcng9IjEyIiByeT0iOCIvPgogICAgPGVsbGlwc2UgY3g9IjE5MCIgY3k9IjM1IiByeD0iMTUiIHJ5PSIxMCIvPgogICAgPGVsbGlwc2UgY3g9IjIwMCIgY3k9IjM1IiByeD0iMTAiIHJ5PSI3Ii8+CiAgICA8ZWxsaXBzZSBjeD0iMjQwIiBjeT0iNTUiIHJ4PSI4IiByeT0iNiIvPgogICAgPGVsbGlwc2UgY3g9IjI0OCIgY3k9IjU1IiByeD0iMTAiIHJ5PSI4Ii8+CiAgICA8ZWxsaXBzZSBjeD0iMjU1IiBjeT0iNTUiIHJ4PSI3IiByeT0iNSIvPgogIDwvZz4KICA8IS0tIEhvdXNlIG1haW4gc3RydWN0dXJlIC0tPgogIDxyZWN0IHg9IjgwIiB5PSIxMjAiIHdpZHRoPSIxNDAiIGhlaWdodD0iMTAwIiBmaWxsPSJ1cmwoI2hvdXNlR3JhZGllbnQpIiBzdHJva2U9IiNEM0QzRDMiIHN0cm9rZS13aWR0aD0iMSIvPgogIDwhLS0gUm9vZiAtLT4KICA8cG9seWdvbiBwb2ludHM9IjcwLDEyMCAxNTAsNzAgMjMwLDEyMCIgZmlsbD0idXJsKCNyb29mR3JhZGllbnQpIiBzdHJva2U9IiM1RDRFMzciIHN0cm9rZS13aWR0aD0iMSIvPgogIDwhLS0gQ2hpbW5leSAtLT4KICA8cmVjdCB4PSIxOTAiIHk9IjgwIiB3aWR0aD0iMTUiIGhlaWdodD0iMjUiIGZpbGw9IiM4QjQ1MTMiIHN0cm9rZT0iIzY1NDMyMSIgc3Ryb2tlLXdpZHRoPSIxIi8+CiAgPHJlY3QgeD0iMTg1IiB5PSI4MCIgd2lkdGg9IjI1IiBoZWlnaHQ9IjUiIGZpbGw9IiNBMDUyMkQiLz4KICA8IS0tIENoaW1uZXkgc21va2UgLS0+CiAgPGcgZmlsbD0ibGlnaHRncmF5IiBvcGFjaXR5PSIwLjYiPgogICAgPGNpcmNsZSBjeD0iMTk4IiBjeT0iNzAiIHI9IjMiLz4KICAgIDxjaXJjbGUgY3g9IjE5NSIgY3k9IjY1IiByPSIyLjUiLz4KICAgIDxjaXJjbGUgY3g9IjIwMCIgY3k9IjYwIiByPSIyIi8+CiAgICA8Y2lyY2xlIGN4PSIxOTciIGN5PSI1NSIgcj0iMS41Ii8+CiAgPC9nPgogIDwhLS0gRG9vciAtLT4KICA8cmVjdCB4PSIxMzUiIHk9IjE3MCIgd2lkdGg9IjMwIiBoZWlnaHQ9IjUwIiBmaWxsPSIjOEI0NTEzIiBzdHJva2U9IiM2NTQzMjEiIHN0cm9rZS13aWR0aD0iMSIgcng9IjE1IiByeT0iMCIvPgogIDxjaXJjbGUgY3g9IjE1NyIgY3k9IjE5NSIgcj0iMiIgZmlsbD0iI0ZGRDcwMCIvPgogIDwhLS0gRG9vciBwYW5lbHMgLS0+CiAgPHJlY3QgeD0iMTQwIiB5PSIxNzUiIHdpZHRoPSIyMCIgaGVpZ2h0PSIxNSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNjU0MzIxIiBzdHJva2Utd2lkdGg9IjEiIHJ4PSIyIi8+CiAgPHJlY3QgeD0iMTQwIiB5PSIxOTUiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNjU0MzIxIiBzdHJva2Utd2lkdGg9IjEiIHJ4PSIyIi8+CiAgPCEtLSBXaW5kb3dzIC0tPgogIDxyZWN0IHg9Ijk1IiB5PSIxNDAiIHdpZHRoPSIyNSIgaGVpZ2h0PSIyNSIgZmlsbD0iIzg3Q0VFQiIgc3Ryb2tlPSIjNDY4MkI0IiBzdHJva2Utd2lkdGg9IjIiIHJ4PSIyIi8+CiAgPGxpbmUgeDE9IjEwNy41IiB5MT0iMTQwIiB4Mj0iMTA3LjUiIHkyPSIxNjUiIHN0cm9rZT0iIzQ2ODJCNCIgc3Ryb2tlLXdpZHRoPSIxIi8+CiAgPGxpbmUgeDE9Ijk1IiB5MT0iMTUyLjUiIHgyPSIxMjAiIHkyPSIxNTIuNSIgc3Ryb2tlPSIjNDY4MkI0IiBzdHJva2Utd2lkdGg9IjEiLz4KICA8cmVjdCB4PSIxODAiIHk9IjE0MCIgd2lkdGg9IjI1IiBoZWlnaHQ9IjI1IiBmaWxsPSIjODdDRUVCIiBzdHJva2U9IiM0NjgyQjQiIHN0cm9rZS13aWR0aD0iMiIgcng9IjIiLz4KICA8bGluZSB4MT0iMTkyLjUiIHkxPSIxNDAiIHgyPSIxOTIuNSIgeTI9IjE2NSIgc3Ryb2tlPSIjNDY4MkI0IiBzdHJva2Utd2lkdGg9IjEiLz4KICA8bGluZSB4MT0iMTgwIiB5MT0iMTUyLjUiIHgyPSIyMDUiIHkyPSIxNTIuNSIgc3Ryb2tlPSIjNDY4MkI0IiBzdHJva2Utd2lkdGg9IjEiLz4KICA8IS0tIFVwc3RhaXJzIHdpbmRvdyAtLT4KICA8cmVjdCB4PSIxMzcuNSIgeT0iMTAwIiB3aWR0aD0iMjUiIGhlaWdodD0iMjAiIGZpbGw9IiM4N0NFRUIiIHN0cm9rZT0iIzQ2ODJCNCIgc3Ryb2tlLXdpZHRoPSIyIiByeD0iMiIvPgogIDxsaW5lIHgxPSIxNTAiIHkxPSIxMDAiIHgyPSIxNTAiIHkyPSIxMjAiIHN0cm9rZT0iIzQ2ODJCNCIgc3Ryb2tlLXdpZHRoPSIxIi8+CiAgPGxpbmUgeDE9IjEzNy41IiB5MT0iMTEwIiB4Mj0iMTYyLjUiIHkyPSIxMTAiIHN0cm9rZT0iIzQ2ODJCNCIgc3Ryb2tlLXdpZHRoPSIxIi8+CiAgPCEtLSBXaW5kb3cgYm94ZXMgd2l0aCBmbG93ZXJzIC0tPgogIDxyZWN0IHg9IjkzIiB5PSIxNjUiIHdpZHRoPSIyOSIgaGVpZ2h0PSI0IiBmaWxsPSIjOEI0NTEzIi8+CiAgPHJlY3QgeD0iMTc4IiB5PSIxNjUiIHdpZHRoPSIyOSIgaGVpZ2h0PSI0IiBmaWxsPSIjOEI0NTEzIi8+CiAgPCEtLSBGbG93ZXJzIGluIHdpbmRvdyBib3hlcyAtLT4KICA8Zz4KICAgIDxjaXJjbGUgY3g9IjEwMCIgY3k9IjE2MyIgcj0iMS41IiBmaWxsPSIjRkY2OUI0Ii8+CiAgICA8Y2lyY2xlIGN4PSIxMDUiIGN5PSIxNjMiIHI9IjEuNSIgZmlsbD0iI0ZGMTQ5MyIvPgogICAgPGNpcmNsZSBjeD0iMTEwIiBjeT0iMTYzIiByPSIxLjUiIGZpbGw9IiNGRkI2QzEiLz4KICAgIDxjaXJjbGUgY3g9IjExNSIgY3k9IjE2MyIgcj0iMS41IiBmaWxsPSIjRkY2OUI0Ii8+CiAgICA8Y2lyY2xlIGN4PSIxODUiIGN5PSIxNjMiIHI9IjEuNSIgZmlsbD0iIzkzNzBEQiIvPgogICAgPGNpcmNsZSBjeD0iMTkwIiBjeT0iMTYzIiByPSIxLjUiIGZpbGw9IiM4QTJCRTIiLz4KICAgIDxjaXJjbGUgY3g9IjE5NSIgY3k9IjE2MyIgcj0iMS41IiBmaWxsPSIjOTM3MERCIi8+CiAgICA8Y2lyY2xlIGN4PSIyMDAiIGN5PSIxNjMiIHI9IjEuNSIgZmlsbD0iI0REQTBERCIvPgogIDwvZz4KICA8IS0tIFRyZWUgLS0+CiAgPGVsbGlwc2UgY3g9IjM1IiBjeT0iMTYwIiByeD0iMjAiIHJ5PSIyNSIgZmlsbD0iIzIyOEIyMiIvPgogIDxyZWN0IHg9IjMyIiB5PSIxODAiIHdpZHRoPSI2IiBoZWlnaHQ9IjE1IiBmaWxsPSIjOEI0NTEzIi8+CiAgPCEtLSBQYXRoIHRvIGRvb3IgLS0+CiAgPHBhdGggZD0iTSAxNTAgMjIwIFEgMTUwIDIxMCAxNTAgMjAwIFEgMTUwIDE5MCAxNTAgMTgwIiBzdHJva2U9IiNEMkI0OEMiIHN0cm9rZS13aWR0aD0iOCIgZmlsbD0ibm9uZSIgb3BhY2l0eT0iMC42Ii8+CiAgPCEtLSBHYXJkZW4gZWxlbWVudHMgLS0+CiAgPGNpcmNsZSBjeD0iMjYwIiBjeT0iMjAwIiByPSI4IiBmaWxsPSIjMzJDRDMyIi8+CiAgPGNpcmNsZSBjeD0iMjcwIiBjeT0iMTk1IiByPSI2IiBmaWxsPSIjMjI4QjIyIi8+CiAgPGNpcmNsZSBjeD0iMjUwIiBjeT0iMjA1IiByPSI1IiBmaWxsPSIjN0NGQzAwIi8+Cjwvc3ZnPg==`;
};

export const createImageErrorFallback = () => {
  return `data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjNmNGY2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzlDQTNBRiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlIEF2YWlsYWJsZTwvdGV4dD48L3N2Zz4=`;
};
